# ＜AWS環境＞　
# CloudFormationでテンプレートを使ってEC2インスタンスを構築する

> テンプレートはMeetingPolice用に最適化しています。汎用のものではないので、他用途の場合は要件に応じて修正が必要です。

## ☆何ができるか？

MeetingPoliceでは、ミーティング参加ページや管理ページはEC2で動作します。
EC2はLinuxをはじめとしたOSが入ったサーバ（=インスタンス）を稼働させることができます。
インスタンスの作成にはOSの選択や、セキュリティ設定、権限付与などを設定する必要がありますが、作業量が多いです。
そこで、CloudFormationのサービスを使って、構築をテンプレートに沿って自動で作成することができます。
テンプレートを使うと、「簡単に作れる」「全員が全く同じ環境を構築できる」というメリットがあります。

> 作業を簡略化しています。基本的なEC2の構築手順や仕組みは技術ハンズオンで理解しましょう！

## ☆テンプレートでは何をしているか？

* 東京リージョンにUbuntu Server 22.04 LTSのインスタンス（t3.small）を構築
* セキュリティグループの設定（SSH, HTTP, HTTPS許可）と固定IP化
* IAMロール（権限）の付与
* 基本パッケージのインストール
* FastAPI + Nginx + ReactをHTTPS自己署名証明書つきで構築
* 2GBのスワップ領域追加
* GitHubからMeetingPoliceのプロジェクトファイルをクローン
* SSM接続時にubuntuユーザーに自動切り替え設定

## ☆構築手順

1.  AWSマネジメントコンソールで「EC2 ＞ キーペア」を開き、新規に「EC2-keypair」を作成します（名前以外はデフォルト）。
2.  トップページの「CloudFormation」からスタック作成画面を開きます。
3.  ステップ1：テンプレートの指定で「テンプレートファイルのアップロード」を選ぶ。
「MeetingPoliceEC2-t3small.yaml」をアップロードして次へ。
4.  ステップ2：スタック名を「MeetingPoliceEC2」に設定して次へ。
5.  ステップ3：一番下のチェックボックスを入れて次へ。
6.  ステップ4：そのまま進み、送信します。
7.  テンプレートに沿って、EC2インスタンスが自動的に作成されます。

## ☆接続手順

1.  構築完了後、EC2 ＞ インスタンスを開くと「MeetingPolice-Server」が作成されています。
2.  インスタンスを選択し、右クリックから「接続」を開きます。
3.  「セッションマネージャー」タブを選択して、サーバにアクセスします。
4.  接続が完了すると、ターミナルから操作できるようになります。
